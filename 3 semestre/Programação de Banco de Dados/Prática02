CREATE TABLE DEPARTAMENTO(
DEP_COD_DEPART NUMBER (4),
DEP_NOME VARCHAR2 (30) NOT NULL,
DEP_DATA_INICIAL DATE,
CONSTRAINT FK_COD_DEPART PRIMARY KEY (DEP_COD_DEPART)
)

CREATE TABLE FUNCIONARIO(
FUN_COD_FUNC NUMBER(4),
FUN_NOME VARCHAR2(100) NOT NULL,
FUN_CPF VARCHAR2(15),
FUN_SALARIO NUMBER(6,2),
FUN_ENDERECO VARCHAR(252),
FUN_SEXO CHAR(1),
FUN_COD_SUPER NUMBER(4),
FUN_COD_DEPART NUMBER(4),
CONSTRAINT UK_FUN_CPF UNIQUE (FUN_CPF),
CONSTRAINT PK_FUN_COD_FUNC PRIMARY KEY (FUN_COD_FUNC),
CONSTRAINT CK_FUN_SALARIO CHECK (FUN_SALARIO > 1000),
CONSTRAINT CK_FUN_SEXO CHECK (FUN_SEXO IN('F', 'M')),
CONSTRAINT FK_FUN_COD_SUPER FOREIGN KEY (FUN_COD_SUPER) REFERENCES FUNCIONARIO(FUN_COD_FUNC),
CONSTRAINT FK_FUN_COD_DEPART FOREIGN KEY (FUN_COD_DEPART) REFERENCES DEPARTAMENTO(DEP_COD_DEPART)

)

CREATE TABLE LOCALIZACAO(
LOC_COD_DEPART NUMBER (4),
LOC_LOCAL VARCHAR (252),
CONSTRAINT PK_LOC PRIMARY KEY (LOC_LOCAL,LOC_COD_DEPART),
CONSTRAINT FK_LOC_COD_DEPART FOREIGN KEY (LOC_COD_DEPART) REFERENCES DEPARTAMENTO(DEP_COD_DEPART)
)

CREATE TABLE DEPENTENDE(
DEPE_COD_FUNC NUMBER (4),
DEPE_SEQ NUMBER(4),
DEPE_NOME VARCHAR2(100) NOT NULL,
DEPE_PARENTESCO VARCHAR(30) NOT NULL,
DEPE_DATA_NASC DATE,
CONSTRAINT CK_DEPE_PARENTESCO CHECK (DEPE_PARENTESCO IN ('PAI','MAE','IRMAOS','FILHO')),
CONSTRAINT FK_DEPE_COD_FUNC FOREIGN KEY (DEPE_COD_FUNC) REFERENCES FUNCIONARIO(FUN_COD_FUNC),
CONSTRAINT PK_DEPE PRIMARY KEY (DEPE_COD_FUNC,DEPE_SEQ)
)

CREATE TABLE PROJETO(
PRO_COD_PROJ NUMBER(4),
PRO_COD_DEPART NUMBER(4),
PRO_TITULO VARCHAR2(150) NOT NULL,
PRO_DESCRICAO VARCHAR2(252),
PRO_DATA_CAD DATE DEFAULT SYSDATE,
CONSTRAINT PK_PRO_COD_PROJ PRIMARY KEY (PRO_COD_PROJ),
CONSTRAINT PK_PRO_COD_DEPART FOREIGN KEY (PRO_COD_DEPART) REFERENCES DEPARTAMENTO(DEP_COD_DEPART)
)

CREATE TABLE PARTICIPA(
PAR_COD_FUN NUMBER(4),
PAR_COD_PROJ NUMBER(4),
PAR_HORAS VARCHAR2(50),
CONSTRAINT FK_PAR_COD_FUNC FOREIGN KEY (PAR_COD_FUN) REFERENCES FUNCIONARIO(FUN_COD_FUNC),
CONSTRAINT FK_PAR_COD_PROJ FOREIGN KEY (PAR_COD_PROJ) REFERENCES PROJETO(PRO_COD_PROJ),
CONSTRAINT PK_PARTICIPA PRIMARY KEY (PAR_COD_FUN,PAR_COD_PROJ)
)

ALTER TABLE PROJETO ADD PRO_STATUS NUMBER(1) NOT NULL;
ALTER TABLE PROJETO ADD CONSTRAINT CK_PRO_STATUS CHECK (PRO_STATUS IN(1,0));
ALTER TABLE PROJETO MODIFY PRO_TITULO VARCHAR2(252);
ALTER TABLE PROJETO RENAME COLUMN PRO_DATA_CAD TO DATA_CADASTRO;

ALTER TABLE FUNCIONARIO DROP COLUMN FUN_ENDERECO;

CREATE TABLE ENDERECO(
END_COD NUMBER (4),
END_ENDERECO VARCHAR2(252) NOT NULL,
CONSTRAINT UK_END_ENDERECO UNIQUE (END_ENDERECO)
)

ALTER TABLE ENDERECO ADD CONSTRAINT  FK_END_COD PRIMARY KEY (END_COD);

CREATE TABLE ENDFUNCIONARIO(
ENDF_END_COD NUMBER(4),
ENDF_FUN_COD_FUNC NUMBER(4),
CONSTRAINT FK_ENDF_END_COD FOREIGN KEY (ENDF_END_COD) REFERENCES ENDERECO(END_COD),
CONSTRAINT FK_ENDF_FUN_COD FOREIGN KEY (ENDF_FUN_COD_FUNC) REFERENCES FUNCIONARIO(FUN_COD_FUNC),
CONSTRAINT PK_ENDFUNCIONARIO PRIMARY KEY (ENDF_END_COD,ENDF_FUN_COD_FUNC)
)

ALTER TABLE FUNCIONARIO DROP CONSTRAINT CK_FUN_SALARIO;
ALTER TABLE FUNCIONARIO DISABLE CONSTRAINT UK_FUN_CPF;
ALTER TABLE FUNCIONARIO ENABLE CONSTRAINT UK_FUN_CPF;
ALTER TABLE ENDFUNCIONARIO DISABLE CONSTRAINT FK_ENDF_FUN_COD;
ALTER TABLE PARTICIPA DISABLE CONSTRAINT FK_PAR_COD_FUNC;
ALTER TABLE DEPENTENDE DISABLE CONSTRAINT FK_DEPE_COD_FUNC;
ALTER TABLE FUNCIONARIO DISABLE CONSTRAINT FK_FUN_COD_SUPER;
ALTER TABLE FUNCIONARIO DISABLE CONSTRAINT PK_FUN_COD_FUNC;
ALTER TABLE FUNCIONARIO ENABLE CONSTRAINT PK_FUN_COD_FUNC;
ALTER TABLE FUNCIONARIO ENABLE CONSTRAINT FK_FUN_COD_SUPER;
ALTER TABLE DEPENTENDE ENABLE CONSTRAINT FK_DEPE_COD_FUNC;
ALTER TABLE PARTICIPA ENABLE CONSTRAINT FK_PAR_COD_FUNC;
ALTER TABLE ENDFUNCIONARIO ENABLE CONSTRAINT FK_ENDF_FUN_COD;

ALTER TABLE DEPENTENDE RENAME TO DEPENDENTE;
ALTER TABLE DEPENDENTE DROP COLUMN DEPE_PARENTESCO;

CREATE TABLE PARENTESCO(
PAR_COD NUMBER(4),
PAR_DESCRICAO VARCHAR2(254) NOT NULL,
CONSTRAINT PK_PAR_COD PRIMARY KEY (PAR_COD),
CONSTRAINT CK_PAR_DESCRICAO CHECK (PAR_DESCRICAO IN ('PAI','MAE','IRMAOS','FILHO'))
);

ALTER TABLE DEPENDENTE ADD DEPE_PAR_COD NUMBER(4);
ALTER TABLE DEPENDENTE ADD CONSTRAINT FK_DEPE_PAR_COD FOREIGN KEY (DEPE_PAR_COD) REFERENCES PARENTESCO(PAR_COD);
ALTER TABLE DEPENDENTE ADD DEPE_CPF VARCHAR2(15);
ALTER TABLE DEPENDENTE MODIFY DEPE_CPF VARCHAR2(15) NOT NULL;
ALTER TABLE DEPENDENTE ADD CONSTRAINT UK_DEPE_CPF UNIQUE (DEPE_CPF);

ALTER TABLE DEPENDENTE DROP CONSTRAINT FK_DEPE_COD_FUNC;
ALTER TABLE DEPENDENTE ADD CONSTRAINT FK_DEPE_COD_FUNC FOREIGN KEY (DEPE_COD_FUNC) REFERENCES FUNCIONARIO(FUN_COD_FUNC) ON DELETE CASCADE;

ALTER TABLE PARTICIPA RENAME TO FUNC_PROJETO;

